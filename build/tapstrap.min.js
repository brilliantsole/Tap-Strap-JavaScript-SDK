/**
 * @copyright Zack Qattan 2024
 * @license MIT
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).TS={})}(this,(function(e){"use strict";function t(e,t,s,i){if("a"===s&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?i:"a"===s?i.call(e):i?i.value:t.get(e)}function s(e,t,s,i,n){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?n.call(e,s):n?n.value=s:t.set(e,s),s}"function"==typeof SuppressedError&&SuppressedError;const i=!1,n="undefined"!=typeof window&&void 0!==window?.document,r="undefined"!=typeof process&&null!=process?.versions?.node,a=n&&navigator.userAgent||"";let o=!1;n?o=Boolean(navigator.bluetooth):r&&(o=!0);const c=n&&/Bluefy/i.test(a),h=n&&/WebBLE/i.test(a),l=n&&/Android/i.test(a),u=n&&/Safari/i.test(a)&&!/Chrome/i.test(a),d=n&&/iPad|iPhone|iPod/i.test(a),f=n&&/Macintosh/i.test(a),g=!n&&!r&&"undefined"!=typeof global&&"undefined"!=typeof Studio;var v,m,p,w,b=Object.freeze({__proto__:null,isAndroid:l,get isBluetoothSupported(){return o},isIOS:d,isInBluefy:c,isInBrowser:n,isInDev:i,isInLensStudio:g,isInNode:r,isInProduction:!0,isInWebBLE:h,isMac:f,isSafari:u});if(g){const e=function(...e){Studio.log(e.map((e=>new String(e))).join(","))};(w={}).log=e,w.warn=e.bind(w,"WARNING"),w.error=e.bind(w,"ERROR")}else w=console;if(!w.assert){const e=(e,...t)=>{e||w.warn(...t)};w.assert=e}if(!w.table){const e=(...e)=>{w.log(...e)};w.table=e}function y(){}const E=w.log.bind(w),D=w.warn.bind(w),M=w.error.bind(w),S=w.table.bind(w),C=w.assert.bind(w);class W{constructor(e){if(p.set(this,{log:i,warn:i,assert:!0,error:!0,table:!0}),t(v,v,"f",m)[e])throw new Error(`"${e}" console already exists`);t(v,v,"f",m)[e]=this}setLevelFlags(e){Object.assign(t(this,p,"f"),e)}static setLevelFlagsForType(e,s){if(!t(this,v,"f",m)[e])throw new Error(`no console found with type "${e}"`);t(this,v,"f",m)[e].setLevelFlags(s)}static setAllLevelFlags(e){for(const s in t(this,v,"f",m))t(this,v,"f",m)[s].setLevelFlags(e)}static create(e,s){return t(this,v,"f",m)[e]||new v(e)}get log(){return t(this,p,"f").log?E:y}get warn(){return t(this,p,"f").warn?D:y}get error(){return t(this,p,"f").error?M:y}get assert(){return t(this,p,"f").assert?C:y}get table(){return t(this,p,"f").table?S:y}assertWithError(e,t){if(!Boolean(e))throw new Error(t)}assertTypeWithError(e,t){this.assertWithError(typeof e==t,`value ${e} of type "${typeof e}" not of type "${t}"`)}assertEnumWithError(e,t){this.assertWithError(t.includes(e),`invalid enum "${e}"`)}}function k(e,t){return W.create(e,t)}v=W,p=new WeakMap,m={value:{}};const I=k("EventDispatcher",{log:!1});class R{constructor(e,t){this.target=e,this.validEventTypes=t,this.listeners={},this.addEventListener=this.addEventListener.bind(this),this.removeEventListener=this.removeEventListener.bind(this),this.removeEventListeners=this.removeEventListeners.bind(this),this.removeAllEventListeners=this.removeAllEventListeners.bind(this),this.dispatchEvent=this.dispatchEvent.bind(this),this.waitForEvent=this.waitForEvent.bind(this)}isValidEventType(e){return this.validEventTypes.includes(e)}updateEventListeners(e){this.listeners[e]&&(this.listeners[e]=this.listeners[e].filter((t=>(t.shouldRemove&&I.log(`removing "${e}" eventListener`,t),!t.shouldRemove))))}addEventListener(e,t,s={once:!1}){if(!this.isValidEventType(e))throw new Error(`Invalid event type: ${e}`);this.listeners[e]||(this.listeners[e]=[],I.log(`creating "${e}" listeners array`,this.listeners[e]));this.listeners[e].find((e=>e.listener==t&&e.once==s.once))?I.log("already added listener"):(I.log(`adding "${e}" listener`,t,s),this.listeners[e].push({listener:t,once:s.once}),I.log(`currently have ${this.listeners[e].length} "${e}" listeners`))}removeEventListener(e,t){if(!this.isValidEventType(e))throw new Error(`Invalid event type: ${e}`);this.listeners[e]&&(I.log(`removing "${e}" listener...`,t),this.listeners[e].forEach((s=>{s.listener===t&&(I.log(`flagging "${e}" listener`,t),s.shouldRemove=!0)})),this.updateEventListeners(e))}removeEventListeners(e){if(!this.isValidEventType(e))throw new Error(`Invalid event type: ${e}`);this.listeners[e]&&(I.log(`removing "${e}" listeners...`),this.listeners[e]=[])}removeAllEventListeners(){I.log("removing listeners..."),this.listeners={}}dispatchEvent(e,t){if(!this.isValidEventType(e))throw new Error(`Invalid event type: ${e}`);this.listeners[e]&&(this.listeners[e].forEach((s=>{s.shouldRemove||(I.log(`dispatching "${e}" listener`,s),s.listener({type:e,target:this.target,message:t}),s.once&&(I.log(`flagging "${e}" listener`,s),s.shouldRemove=!0))})),this.updateEventListeners(e))}waitForEvent(e){return new Promise((t=>{this.addEventListener(e,(e=>{t(e)}),{once:!0})}))}}var A,L,x;const T=k("Timer",{log:!1});class ${get callback(){return t(this,A,"f")}set callback(e){T.assertTypeWithError(e,"function"),T.log({newCallback:e}),s(this,A,e,"f"),this.isRunning&&this.restart()}get interval(){return t(this,L,"f")}set interval(e){T.assertTypeWithError(e,"number"),T.assertWithError(e>0,"interval must be above 0"),T.log({newInterval:e}),s(this,L,e,"f"),this.isRunning&&this.restart()}constructor(e,t){A.set(this,void 0),L.set(this,void 0),x.set(this,void 0),this.interval=t,this.callback=e}get isRunning(){return null!=t(this,x,"f")}start(e=!1){this.isRunning?T.log("interval already running"):(T.log("starting interval"),s(this,x,setInterval(t(this,A,"f"),t(this,L,"f")),"f"),e&&t(this,A,"f").call(this))}stop(){this.isRunning?(T.log("stopping interval"),clearInterval(t(this,x,"f")),s(this,x,void 0,"f")):T.log("interval already not running")}restart(e=!1){this.stop(),this.start(e)}}var U,O;A=new WeakMap,L=new WeakMap,x=new WeakMap,U="undefined"==typeof TextEncoder?class{encode(e){const t=Array.from(e).map((e=>e.charCodeAt(0)));return Uint8Array.from(t)}}:TextEncoder,O="undefined"==typeof TextDecoder?class{decode(e){return Array.from(new Uint8Array(e)).map((e=>String.fromCharCode(e))).join("")}}:TextDecoder;const G=new U,B=new O;var F,N,j,V,_;const P=k("DeviceInformationManager",{log:!0}),z=["manufacturerName","modelNumber","softwareRevision","hardwareRevision","firmwareRevision","pnpId","serialNumber"],J=[...z,"deviceInformation"];class K{constructor(){F.add(this),j.set(this,{})}get information(){return t(this,j,"f")}clear(){s(this,j,{},"f")}parseMessage(e,s){switch(P.log({messageType:e}),e){case"manufacturerName":const i=B.decode(s.buffer);P.log({manufacturerName:i}),t(this,F,"m",_).call(this,{manufacturerName:i});break;case"modelNumber":const n=B.decode(s.buffer);P.log({modelNumber:n}),t(this,F,"m",_).call(this,{modelNumber:n});break;case"softwareRevision":const r=B.decode(s.buffer);P.log({softwareRevision:r}),t(this,F,"m",_).call(this,{softwareRevision:r});break;case"hardwareRevision":const a=B.decode(s.buffer);P.log({hardwareRevision:a}),t(this,F,"m",_).call(this,{hardwareRevision:a});break;case"firmwareRevision":const o=B.decode(s.buffer);P.log({firmwareRevision:o}),t(this,F,"m",_).call(this,{firmwareRevision:o});break;case"pnpId":const c={source:1===s.getUint8(0)?"Bluetooth":"USB",productId:s.getUint16(3,!0),productVersion:s.getUint16(5,!0),vendorId:0};"Bluetooth"==c.source&&(c.vendorId=s.getUint16(1,!0)),P.log({pnpId:c}),t(this,F,"m",_).call(this,{pnpId:c});break;case"serialNumber":const h=B.decode(s.buffer);P.log({serialNumber:h});break;default:throw Error(`uncaught messageType ${e}`)}}}j=new WeakMap,F=new WeakSet,N=function(){return this.eventDispatcher.dispatchEvent},V=function(){return z.every((e=>{switch(e){case"modelNumber":case"serialNumber":return!0;default:return e in t(this,j,"f")}}))},_=function(e){P.log({partialDeviceInformation:e});Object.keys(e).forEach((s=>{t(this,F,"a",N).call(this,s,{[s]:e[s]})})),Object.assign(t(this,j,"f"),e),P.log({deviceInformation:t(this,j,"f")}),t(this,F,"a",V)&&(P.log("completed deviceInformation"),t(this,F,"a",N).call(this,"deviceInformation",{deviceInformation:this.information}))};function X(e,{include:t,exclude:s}={}){const i=e=>{const i=t=>"string"==typeof t?e===t:t.test(e);return t?t.some(i):!s||!s.some(i)};for(const[t,s]of(e=>{const t=new Set;do{for(const s of Reflect.ownKeys(e))t.add([e,s])}while((e=Reflect.getPrototypeOf(e))&&e!==Object.prototype);return t})(e.constructor.prototype)){if("constructor"===s||!i(s))continue;const n=Reflect.getOwnPropertyDescriptor(t,s);n&&"function"==typeof n.value&&(e[s]=e[s].bind(e))}return e}const q={oneFingerUp:2,twoFingersUp:3,oneFingerDown:4,twoFingersDown:5,oneFingerLeft:6,twoFingersLeft:7,oneFingerRight:8,twoFingersRight:9,indexToThumbTouch:10,middleToThumbTouch:11,xrAirGestureNone:100,xrAirGestureThumbIndex:101,xrAirGestureThumbMiddle:102},H={};Object.keys(q).forEach((e=>{H[e]=q[e]}));const Q={clickIndex:1,clickMiddle:2,dragIndex:3,dragMiddle:4,drop:5,potentialDragOrClickIndex:6,potentialDragOrClickMiddle:7},Y={};var Z,ee,te;Object.keys(Q).forEach((e=>{Y[e]=Q[e]}));const se=k("TapDataManager"),ie=["tapData"],ne=[...ie,"tapAirGesture"],re=["thumb","index","middle","ring","pinky"];class ae{constructor(){Z.add(this),this.isInAirGestureState=!1,X(this)}parseMessage(e,s){if(se.log({messageType:e}),"tapData"!==e)throw Error(`uncaught messageType ${e}`);t(this,Z,"m",te).call(this,s)}}var oe,ce,he;Z=new WeakSet,ee=function(){return this.eventDispatcher.dispatchEvent},te=function(e){se.log("parsing tap data",e);const s=e.getUint8(0);if(this.isInAirGestureState){const e=function(e){switch(e){case 2:return"indexToThumbTouch";case 4:return"middleToThumbTouch"}}(s);se.log({tapAirGesture:e}),e&&t(this,Z,"a",ee).call(this,"tapAirGesture",{tapAirGesture:e})}else{let i;if(e.byteLength>=4){const t=e.getUint8(3);i={shiftState:3&t,switchState:t>>2&3,multitap:Math.min(1+(t>>4&3),3)}}const n={};se.log("fingerBits",s.toString(2)),re.forEach(((e,t)=>{n[e]=!!(s&1<<t)})),se.log("fingers",n),t(this,Z,"a",ee).call(this,"tapData",{fingers:n,keyboardState:i})}};const le=k("MouseDataManager"),ue=["mouseData"],de=[...ue];class fe{constructor(){oe.add(this),X(this)}parseMessage(e,s){if(le.log({messageType:e}),"mouseData"!==e)throw Error(`uncaught messageType ${e}`);t(this,oe,"m",he).call(this,s)}}var ge,ve,me,pe,we;oe=new WeakSet,ce=function(){return this.eventDispatcher.dispatchEvent},he=function(e){le.log("parsing mouse data",e);if(0!=e.getUint8(0))return;const s={x:e.getInt16(1,!0),y:e.getInt16(3,!0)},i=1==e.getUint8(9);t(this,oe,"a",ce).call(this,"mouseData",{velocity:s,isMouse:i})};const be=k("AirGestureManager"),ye=["airGesture"],Ee=[...ye,"isInAirGestureState","xrAirGesture"];class De{constructor(){ge.add(this),me.set(this,!1),X(this)}get isInState(){return t(this,me,"f")}parseMessage(e,s){if(be.log({messageType:e}),"airGesture"!==e)throw Error(`uncaught messageType ${e}`);t(this,ge,"m",we).call(this,s)}}me=new WeakMap,ge=new WeakSet,ve=function(){return this.eventDispatcher.dispatchEvent},pe=function(e){s(this,me,e,"f"),t(this,ge,"a",ve).call(this,"isInAirGestureState",{isInAirGestureState:t(this,me,"f")})},we=function(e){be.log("parsing air gesture",e);const s=e.getUint8(0);if(20==s){const s=e.getUint8(1);t(this,ge,"m",pe).call(this,1==s)}else{let e=H[s];if(be.log({airGesture:e}),e)t(this,ge,"a",ve).call(this,"airGesture",{airGesture:e});else{const e=Y[s];be.log({xrAirGesture:e}),e&&t(this,ge,"a",ve).call(this,"xrAirGesture",{xrAirGesture:e})}}};const Me=k("RawSensorUtils"),Se=["deviceAccelerometer","imuGyroscope","imuAccelerometer"],Ce={deviceAccelerometer:[31.25,3.90625,7.8125,15.625,31.25],imuGyroscope:[17.5,4.375,8.75,17.5,35,70],imuAccelerometer:[.122,.061,.122,.244,.488]},We={deviceAccelerometer:0,imuGyroscope:0,imuAccelerometer:0},ke={imu:12,device:30};function Ie(e,t){const s=Ce[e][t];Me.assertWithError(null!=s,`invalid RawSensorSensitivity index ${t} for sensor "${e}" (got value ${s})`)}const Re=["gyroscope","accelerometer"],Ae=["thumb","index","middle","ring","pinky"],Le=k("ArrayBufferUtils",{log:!1});function xe(...e){const t=(e=(e=(e=e.filter((e=>null!=e||null!=e))).map((e=>{if("number"==typeof e){const t=e;return Uint8Array.from([Math.floor(t)])}if("boolean"==typeof e){const t=e;return Uint8Array.from([t?1:0])}if("string"==typeof e){return Te(e)}if(e instanceof Array){return xe(...e)}if(e instanceof ArrayBuffer)return e;if("buffer"in e&&e.buffer instanceof ArrayBuffer){return e.buffer}if(e instanceof DataView){return e.buffer}if("object"==typeof e){return function(e){return Te(JSON.stringify(e))}(e)}return e}))).filter((e=>e&&"byteLength"in e))).reduce(((e,t)=>e+t.byteLength),0),s=new Uint8Array(t);let i=0;return e.forEach((e=>{s.set(new Uint8Array(e),i),i+=e.byteLength})),s.buffer}function Te(e){const t=G.encode(e);return xe(t.byteLength,t)}function $e(e,t,s){let i;return null!=s&&(i=e.byteOffset+t+s),Le.log({dataView:e,begin:t,end:i,length:s}),new DataView(e.buffer.slice(e.byteOffset+t,i))}var Ue,Oe,Ge,Be;const Fe=k("RawSensorManager"),Ne=["rawSensor"],je=[...Ne,"imu","device"];class Ve{constructor(){Ue.add(this),X(this)}parseMessage(e,s){if(Fe.log({messageType:e}),"rawSensor"!==e)throw Error(`uncaught messageType ${e}`);t(this,Ue,"m",Ge).call(this,s)}}var _e,Pe,ze;Ue=new WeakSet,Oe=function(){return this.eventDispatcher.dispatchEvent},Ge=function(e){Fe.log("parsing whole",e);let s=0;for(;s+4<e.byteLength;){const i=e.getUint32(0,!0);s+=4,Fe.log({rawValue:i});const n=(2147483648&i)>>31,r=2147483647&i;if(Fe.log({firstBit:n,timestamp:r}),0==r)break;const a=0==n?"imu":"device";Fe.log({sensorDataType:a});const o=ke[a];if(Fe.log({sensorDataLength:o}),0==o)break;const c=$e(e,s,o);c.byteLength==o&&t(this,Ue,"m",Be).call(this,a,r,c),s+=o}},Be=function(e,s,i){Fe.log(`parsing ${e} ${s}ms`,i);let n="device"==e?"deviceAccelerometer":"imuGyroscope";const r=[];for(let t=0;t<i.byteLength;t+=6){const s=this.sensitivity[n],a=Ce[n][s],[o,c,h]=[i.getInt16(t+0,!0),i.getInt16(t+2,!0),i.getInt16(t+4,!0)].map((e=>e*a));Fe.log({x:o,y:c,z:h});const l={x:o,y:c,z:h};Fe.log("vector",l),r.push(l),"imu"==e&&(n="imuAccelerometer")}let a=0;switch(e){case"imu":a=2;break;case"device":a=5}if(r.length!=a)return void Fe.log(`invalid number of ${e} vectors (expected ${a}, get ${r.length})`);const o={sensorDataType:e,timestamp:s};switch(o.sensorDataType){case"imu":o.accelerometer=r[Re.indexOf("accelerometer")],o.gyroscope=r[Re.indexOf("gyroscope")];break;case"device":o.fingers={},Ae.forEach(((e,t)=>{o.fingers[e]=r[t]}))}t(this,Ue,"a",Oe).call(this,e,o),t(this,Ue,"a",Oe).call(this,"rawSensor",o)};const Je=k("TxManager"),Ke=["tx",...Ne],Xe=[...je];class qe{get eventDispatcher(){return t(this,Pe,"f")}set eventDispatcher(e){s(this,Pe,e,"f"),t(this,ze,"f").eventDispatcher=e}set rawSensorSensitivity(e){t(this,ze,"f").sensitivity=e}constructor(){_e.add(this),Pe.set(this,void 0),ze.set(this,new Ve),X(this)}parseMessage(e,s){if(Je.log({messageType:e}),"tx"!==e)throw Error(`uncaught messageType ${e}`);t(this,ze,"f").parseMessage("rawSensor",s)}}var He,Qe,Ye,Ze,et,tt,st,it,nt;Pe=new WeakMap,ze=new WeakMap,_e=new WeakSet;const rt=k("BaseConnectionManager",{log:!0}),at=["notConnected","connecting","connected","disconnecting"],ot=[...at,"connectionStatus","isConnected"];class ct{get baseConstructor(){return this.constructor}static get isSupported(){return!1}get isSupported(){return this.baseConstructor.isSupported}get type(){return this.baseConstructor.type}constructor(){He.add(this),Ye.set(this,"notConnected"),it.set(this,new $(t(this,He,"m",nt).bind(this),5e3)),t(this,He,"m",Qe).call(this)}get status(){return t(this,Ye,"f")}set status(e){rt.assertEnumWithError(e,at),t(this,Ye,"f")!=e?(rt.log(`new connection status "${e}"`),s(this,Ye,e,"f"),this.onStatusUpdated(this.status),this.isConnected?t(this,it,"f").start():t(this,it,"f").stop()):rt.log(`tried to assign same connection status "${e}"`)}get isConnected(){return"connected"==this.status}async connect(){t(this,He,"m",Ze).call(this),t(this,He,"m",et).call(this),this.status="connecting"}get canReconnect(){return!1}async reconnect(){t(this,He,"m",Ze).call(this),t(this,He,"m",et).call(this),rt.assert(this.canReconnect,"unable to reconnect")}async disconnect(){t(this,He,"m",tt).call(this),t(this,He,"m",st).call(this),this.status="disconnecting",rt.log("disconnecting from device...")}async sendUICommandsData(e){rt.log("sendUICommandsData",e)}async sendRxData(e){rt.log("sendRxData",e)}}Ye=new WeakMap,it=new WeakMap,He=new WeakSet,Qe=function(){rt.assertWithError(this.isSupported,`${this.constructor.name} is not supported`)},Ze=function(){rt.assertWithError(!this.isConnected,"device is already connected")},et=function(){rt.assertWithError("connecting"!=this.status,"device is already connecting")},tt=function(){rt.assertWithError(this.isConnected,"device is not connected")},st=function(){rt.assertWithError("disconnecting"!=this.status,"device is already disconnecting")},nt=function(){this.isConnected||(rt.log("timer detected disconnection"),this.status="notConnected")};const ht=k("EventUtils",{log:!1});function lt(e,t){let s=e.addEventListener||e.addListener||e.on||e.AddEventListener;ht.assertWithError(s,"no add listener function found for target"),s=s.bind(e),Object.entries(t).forEach((([e,t])=>{s(e,t)}))}function ut(e,t){let s=e.removeEventListener||e.removeListener||e.RemoveEventListener;ht.assertWithError(s,"no remove listener function found for target"),s=s.bind(e),Object.entries(t).forEach((([e,t])=>{s(e,t)}))}const dt=k("bluetoothUUIDs",{log:!1});if(n)var ft=window.BluetoothUUID;function gt(e){return dt.assertTypeWithError(e,"string"),dt.assertWithError(1==e.length,"value must be 1 character long"),`C3FF000${e}-1D8B-40FD-A56F-C7BD5D0F3370`.toLowerCase()}function vt(e){return dt.assertTypeWithError(e,"string"),dt.assertWithError(1==e.length,"value must be 1 character long"),`6E40000${e}-B5A3-F393-E0A9-E50E24DCCA9E`.toLowerCase()}function mt(e){return ft?.getCharacteristic?.(e)}function pt(e){return ft?.getService?.(e)}const wt=Object.freeze({services:{deviceInformation:{uuid:pt("device_information"),characteristics:{manufacturerName:{uuid:mt("manufacturer_name_string")},modelNumber:{uuid:mt("model_number_string")},hardwareRevision:{uuid:mt("hardware_revision_string")},firmwareRevision:{uuid:mt("firmware_revision_string")},softwareRevision:{uuid:mt("software_revision_string")},pnpId:{uuid:mt("pnp_id")},serialNumber:{uuid:mt("serial_number_string")}}},battery:{uuid:pt("battery_service"),characteristics:{batteryLevel:{uuid:mt("battery_level")}}},tap:{uuid:gt("1"),characteristics:{tapData:{uuid:gt("5")},mouseData:{uuid:gt("6")},airGesture:{uuid:gt("A")},uiCommands:{uuid:gt("9")},settings:{uuid:gt("2")},unknown3:{uuid:gt("3")},unknown7:{uuid:gt("7")},unknown8:{uuid:gt("8")},unknownB:{uuid:gt("B")},unknownC:{uuid:gt("C")},unknownD:{uuid:gt("D")}}},nus:{uuid:vt("1"),characteristics:{rx:{uuid:vt("2")},tx:{uuid:vt("3")}}}}}),bt=[wt.services.tap.uuid],yt=[wt.services.deviceInformation.uuid,wt.services.battery.uuid,wt.services.nus.uuid];function Et(e){e=e.toString().toLowerCase();return Object.keys(wt.services).find((t=>{let s=wt.services[t].uuid.toString();return 4==e.length&&(s=s.slice(4,8)),e.includes("-")||(s=s.replaceAll("-","")),e==s}))}const Dt=[],Mt=[];function St(e){var t;return e=e.toString().toLowerCase(),Object.values(wt.services).some((s=>{const i=Object.keys(s.characteristics);return t=i.find((t=>{let i=s.characteristics[t].uuid.toString();return 4==e.length&&(i=i.slice(4,8)),e.includes("-")||(i=i.replaceAll("-","")),e==i}))})),t}function Ct(e){const t={broadcast:!1,read:!0,writeWithoutResponse:!1,write:!1,notify:!1,indicate:!1,authenticatedSignedWrites:!1,reliableWrite:!1,writableAuxiliaries:!1};switch(e){case"settings":case"tapData":case"mouseData":case"unknown7":case"unknown8":t.read=!1}switch(e){case"batteryLevel":case"tapData":case"mouseData":case"airGesture":case"unknown8":case"unknownB":case"unknownC":case"unknownD":case"tx":t.notify=!0}switch(e){case"airGesture":case"uiCommands":case"unknown7":case"unknownB":t.writeWithoutResponse=!0}switch(e){case"settings":case"unknown3":case"unknown7":case"rx":t.write=!0}return t}Object.values(wt.services).forEach((e=>{if(!e.characteristics)return;const t=Object.keys(e.characteristics);t.forEach((s=>{const i=e.characteristics[s];bt.includes(e.uuid)&&(Dt.push(i.uuid),t.push(s)),Mt.push(i.uuid)}))}),[]),dt.log({serviceUUIDs:bt,optionalServiceUUIDs:yt,characteristicUUIDs:Dt,allCharacteristicUUIDs:Mt});const Wt=k("BluetoothConnectionManager",{log:!0});class kt extends ct{constructor(){super(...arguments),this.isInRange=!0}onCharacteristicValueChanged(e,t){switch(e){case"batteryLevel":case"firmwareRevision":case"hardwareRevision":case"manufacturerName":case"modelNumber":case"pnpId":case"serialNumber":case"softwareRevision":case"tapData":case"mouseData":case"airGesture":case"tx":this.onMessageReceived?.(e,t)}}async writeCharacteristic(e,t){Wt.log("writeCharacteristic",...arguments)}async sendUICommandsData(e){super.sendUICommandsData(e),await this.writeCharacteristic("uiCommands",e)}async sendRxData(e){super.sendRxData(e),await this.writeCharacteristic("rx",e)}}var It,Rt,At,Lt,xt,Tt,$t,Ut,Ot,Gt,Bt;const Ft=k("WebBluetoothConnectionManager",{log:!0});var Nt,jt,Vt;n&&(Nt=window.navigator.bluetooth);class _t extends kt{constructor(){super(...arguments),It.add(this),Rt.set(this,{characteristicvaluechanged:t(this,It,"m",Ot).bind(this)}),At.set(this,{gattserverdisconnected:t(this,It,"m",Bt).bind(this)}),Lt.set(this,void 0),xt.set(this,new Map),Tt.set(this,new Map)}get bluetoothId(){return this.device?.id||""}get name(){return this.device?.name||""}static get isSupported(){return Boolean(Nt)}static get type(){return"webBluetooth"}get device(){return t(this,Lt,"f")}set device(e){t(this,Lt,"f")!=e?(t(this,Lt,"f")&&ut(t(this,Lt,"f"),t(this,At,"f")),e&&lt(e,t(this,At,"f")),s(this,Lt,e,"f")):Ft.log("tried to assign the same BluetoothDevice")}get server(){return t(this,Lt,"f")?.gatt}get isConnected(){return this.server?.connected||!1}async connect(){await super.connect();try{const e=await Nt.requestDevice({filters:[{services:bt}],optionalServices:n?yt:[]});Ft.log("got BluetoothDevice"),this.device=e,Ft.log("connecting to device...");const s=await this.server.connect();Ft.log(`connected to device? ${s.connected}`),await t(this,It,"m",$t).call(this),Ft.log("fully connected"),this.status="connected"}catch(e){Ft.error(e),this.status="notConnected",this.server?.disconnect(),t(this,It,"m",Ut).call(this)}}async disconnect(){await t(this,It,"m",Ut).call(this),await super.disconnect(),this.server?.disconnect(),this.status="notConnected"}async writeCharacteristic(e,s){super.writeCharacteristic(e,s);const i=t(this,Tt,"f").get(e);Ft.assertWithError(i,`${e} characteristic not found`),Ft.log("writing characteristic",i,s);const n=i.properties||Ct(e);n.writeWithoutResponse?(Ft.log("writing without response"),await i.writeValueWithoutResponse(s)):(Ft.log("writing with response"),await i.writeValueWithResponse(s)),Ft.log("wrote characteristic"),n.read&&!n.notify&&(Ft.log("reading value after write..."),await i.readValue(),(c||h)&&t(this,It,"m",Gt).call(this,i))}get canReconnect(){return Boolean(this.server&&!this.server.connected&&this.isInRange)}async reconnect(){await super.reconnect(),Ft.log("attempting to reconnect..."),this.status="connecting";try{await this.server.connect()}catch(e){Ft.error(e),this.isInRange=!1}this.isConnected?(Ft.log("successfully reconnected!"),await t(this,It,"m",$t).call(this),this.status="connected"):(Ft.log("unable to reconnect"),this.status="notConnected")}}function Pt(e,t=0,s=1){return Math.max(t,Math.min(s,e))}Rt=new WeakMap,At=new WeakMap,Lt=new WeakMap,xt=new WeakMap,Tt=new WeakMap,It=new WeakSet,$t=async function(){t(this,It,"m",Ut).call(this),Ft.log("getting services...");const e=await this.server.getPrimaryServices();Ft.log("got services",e);const s=await this.server.getPrimaryService("6e400001-b5a3-f393-e0a9-e50e24dcca9e");Ft.log("got nus service",s),Ft.log("getting characteristics...");for(const s in e){const i=e[s];Ft.log({service:i});const n=Et(i.uuid);Ft.assertWithError(n,`no name found for service uuid "${i.uuid}"`),Ft.log(`got "${n}" service`),i.name=n,t(this,xt,"f").set(n,i),Ft.log(`getting characteristics for "${n}" service`);const r=await i.getCharacteristics();Ft.log(`got characteristics for "${n}" service`);for(const e in r){const s=r[e];Ft.log({characteristic:s});const i=St(s.uuid);Ft.assertWithError(Boolean(i),`no name found for characteristic uuid "${s.uuid}" in "${n}" service`),Ft.log(`got "${i}" characteristic in "${n}" service`),s.name=i,t(this,Tt,"f").set(i,s),lt(s,t(this,Rt,"f"));const a=s.properties||Ct(i);a.notify&&(Ft.log(`starting notifications for "${i}" characteristic`),await s.startNotifications()),a.read&&(Ft.log(`reading "${i}" characteristic...`),await s.readValue(),(c||h)&&t(this,It,"m",Gt).call(this,s))}}},Ut=async function(){this.device&&ut(this.device,t(this,At,"f"));const e=Array.from(t(this,Tt,"f").keys()).map((e=>{const s=t(this,Tt,"f").get(e);ut(s,t(this,Rt,"f"));if((s.properties||Ct(e)).notify)return Ft.log(`stopping notifications for "${e}" characteristic`),s.stopNotifications()}));return Promise.allSettled(e)},Ot=function(e){Ft.log("oncharacteristicvaluechanged");const s=e.target;t(this,It,"m",Gt).call(this,s)},Gt=function(e){Ft.log("onCharacteristicValue");const t=e.name;Ft.assertWithError(Boolean(t),`no name found for characteristic with uuid "${e.uuid}"`),Ft.log(`oncharacteristicvaluechanged for "${t}" characteristic`);const s=e.value;Ft.assertWithError(s,`no data found for "${t}" characteristic`),Ft.log(`data for "${t}" characteristic`,Array.from(new Uint8Array(s.buffer)));try{this.onCharacteristicValueChanged(t,s)}catch(e){Ft.error(e)}},Bt=function(){Ft.log("gattserverdisconnected"),this.status="notConnected"},k("MathUtils",{log:!0});const zt=k("VibrationManager");class Jt{constructor(){jt.add(this),X(this)}async vibrate(e){zt.log("triggering vibration segments",e);const s=t(this,jt,"m",Vt).call(this,e);await this.sendUICommandsData(s?.buffer)}}var Kt,Xt,qt,Ht,Qt,Yt,Zt,es,ts,ss,is,ns,rs,as,os,cs;jt=new WeakSet,Vt=function(e){const t=new DataView(new ArrayBuffer(20));let s=0;t.setUint8(s++,0),t.setUint8(s++,2);for(let s=0;s<e.length&&s<18;s++){let i=e[s];i/=10,i=Pt(i,0,255),zt.log(`vibration segment #${s}: ${i}`),t.setUint8(2+s,i)}return t};const hs=k("DeviceManager",{log:!0}),ls=["deviceConnected","deviceDisconnected","deviceIsConnected","availableDevices","connectedDevices"];class us{constructor(){if(Kt.add(this),Xt.set(this,{isConnected:t(this,Kt,"m",as).bind(this)}),qt.set(this,[]),Ht.set(this,!1),Qt.set(this,{devices:[]}),Yt.set(this,void 0),es.set(this,"TS.Device"),is.set(this,[]),ns.set(this,new R(this,ls)),us.shared&&this!=us.shared)throw Error("DeviceManager is a singleton - use DeviceManager.shared");this.CanUseLocalStorage&&(this.UseLocalStorage=!0)}onDevice(e){lt(e,t(this,Xt,"f"))}OnDeviceConnectionStatusUpdated(e,s){if("notConnected"==s&&!e.canReconnect&&t(this,is,"f").includes(e)){const s=t(this,is,"f").indexOf(e);this.AvailableDevices.splice(s,1),t(this,Kt,"m",os).call(this)}}get ConnectedDevices(){return t(this,qt,"f")}get UseLocalStorage(){return t(this,Ht,"f")}set UseLocalStorage(e){t(this,Kt,"m",Zt).call(this),hs.assertTypeWithError(e,"boolean"),s(this,Ht,e,"f"),t(this,Ht,"f")&&!t(this,Yt,"f")&&t(this,Kt,"m",ss).call(this)}get CanUseLocalStorage(){return n&&window.localStorage}get AvailableDevices(){return t(this,is,"f")}get CanGetDevices(){return n&&navigator.bluetooth?.getDevices}async GetDevices(){if(!n)return void hs.warn("GetDevices is only available in the browser");if(!navigator.bluetooth)return void hs.warn("bluetooth is not available in this browser");if(c)return void hs.warn("bluefy lists too many devices...");if(!navigator.bluetooth.getDevices)return void hs.warn("bluetooth.getDevices() is not available in this browser");if(!this.CanGetDevices)return void hs.log("CanGetDevices is false");t(this,Yt,"f")||t(this,Kt,"m",ss).call(this);const e=t(this,Yt,"f");if(!e.devices||0==e.devices.length)return void hs.log("no devices found in configuration");const s=await navigator.bluetooth.getDevices();return hs.log({bluetoothDevices:s}),s.forEach((s=>{if(!s.gatt)return;if(!e.devices.find((e=>s.id==e.bluetoothId)))return;let i=this.ConnectedDevices.filter((e=>"webBluetooth"==e.connectionType)).find((e=>e.bluetoothId==s.id));const n=this.AvailableDevices.filter((e=>"webBluetooth"==e.connectionType)).find((e=>e.bluetoothId==s.id));if(n)return void(i&&i?.bluetoothId==n.bluetoothId&&i!=n&&(this.AvailableDevices[t(this,is,"f").indexOf(n)]=i));if(i)return void this.AvailableDevices.push(i);const r=new fi,a=new _t;a.device=s,s.name,r.connectionManager=a,this.AvailableDevices.push(r)})),t(this,Kt,"m",os).call(this),this.AvailableDevices}get AddEventListener(){return t(this,ns,"f").addEventListener}get RemoveEventListener(){return t(this,ns,"f").removeEventListener}get RemoveEventListeners(){return t(this,ns,"f").removeEventListeners}get RemoveAllEventListeners(){return t(this,ns,"f").removeAllEventListeners}}Xt=new WeakMap,qt=new WeakMap,Ht=new WeakMap,Qt=new WeakMap,Yt=new WeakMap,es=new WeakMap,is=new WeakMap,ns=new WeakMap,Kt=new WeakSet,Zt=function(){hs.assertWithError(n,"localStorage is only available in the browser"),hs.assertWithError(window.localStorage,"localStorage not found")},ts=function(){t(this,Kt,"m",Zt).call(this),localStorage.setItem(t(this,es,"f"),JSON.stringify(t(this,Yt,"f")))},ss=async function(){t(this,Kt,"m",Zt).call(this);let e=localStorage.getItem(t(this,es,"f"));if("string"!=typeof e)return hs.log("no info found in localStorage"),s(this,Yt,Object.assign({},t(this,Qt,"f")),"f"),void t(this,Kt,"m",ts).call(this);try{const t=JSON.parse(e);hs.log({configuration:t}),s(this,Yt,t,"f"),this.CanGetDevices&&await this.GetDevices()}catch(e){hs.error(e)}},rs=function(){return t(this,ns,"f").dispatchEvent},as=function(e){const{target:s}=e;if(s.isConnected)if(t(this,qt,"f").includes(s))hs.log("device already included");else{if(hs.log("adding device",s),t(this,qt,"f").push(s),this.UseLocalStorage&&"webBluetooth"==s.connectionType){const e={bluetoothId:s.bluetoothId},i=t(this,Yt,"f").devices.findIndex((t=>t.bluetoothId==e.bluetoothId));-1==i?t(this,Yt,"f").devices.push(e):t(this,Yt,"f").devices[i]=e,t(this,Kt,"m",ts).call(this)}t(this,Kt,"a",rs).call(this,"deviceConnected",{device:s}),t(this,Kt,"a",rs).call(this,"deviceIsConnected",{device:s}),t(this,Kt,"m",cs).call(this)}else t(this,qt,"f").includes(s)?(hs.log("removing device",s),t(this,qt,"f").splice(t(this,qt,"f").indexOf(s),1),t(this,Kt,"a",rs).call(this,"deviceDisconnected",{device:s}),t(this,Kt,"a",rs).call(this,"deviceIsConnected",{device:s}),t(this,Kt,"m",cs).call(this)):hs.log("device already not included");if(this.CanGetDevices&&this.GetDevices(),s.isConnected&&!this.AvailableDevices.includes(s)){const e=this.AvailableDevices.find((e=>e.bluetoothId==s.bluetoothId));hs.log({existingAvailableDevice:e}),e?this.AvailableDevices[this.AvailableDevices.indexOf(e)]=s:this.AvailableDevices.push(s),t(this,Kt,"m",os).call(this)}},os=function(){hs.log({AvailableDevices:this.AvailableDevices}),t(this,Kt,"a",rs).call(this,"availableDevices",{availableDevices:this.AvailableDevices})},cs=function(){hs.log({ConnectedDevices:this.ConnectedDevices}),t(this,Kt,"a",rs).call(this,"connectedDevices",{connectedDevices:this.ConnectedDevices})},us.shared=new us;var ds,fs,gs,vs,ms,ps,ws,bs=us.shared;const ys=k("InputManager"),Es=["controller","text","rawSensor","controllerWithMouse","controllerWithMouseAndKeyboard"],Ds={controller:1,text:0,rawSensor:10,controllerWithMouse:3,controllerWithMouseAndKeyboard:5};class Ms{constructor(){ds.add(this),fs.set(this,Object.assign({},We)),gs.set(this,"controller"),ps.set(this,new $(t(this,ds,"m",ws).bind(this),1e4)),X(this)}get sensitivity(){return t(this,fs,"f")}set sensitivity(e){Object.assign(t(this,fs,"f"),e)}setSensitivityForType(e,s){Ie(e,s),ys.log(`setting ${e} sensitivity index to ${s}`),t(this,fs,"f")[e]=s}get mode(){return t(this,gs,"f")}set mode(e){t(this,ds,"m",vs).call(this,e),this.mode!=e?(s(this,gs,e,"f"),t(this,ps,"f").isRunning&&t(this,ps,"f").restart(!0)):ys.log(`redundant mode assignment "${e}"`)}setMode(e){this.mode=e}start(){t(this,ps,"f").start(!0)}stop(){t(this,ps,"f").stop()}}var Ss,Cs,Ws,ks,Is,Rs;fs=new WeakMap,gs=new WeakMap,ps=new WeakMap,ds=new WeakSet,vs=function(e){ys.assertEnumWithError(e,Es)},ms=function(){const e=Ds[this.mode];let t=[];var s;"rawSensor"==this.mode&&(ys.assertWithError(this.sensitivity,"no sensitivity defined for rawSensor input mode"),s=this.sensitivity,Se.forEach((e=>{Ie(e,s[e])})),Se.forEach((e=>{t.push(this.sensitivity[e])})));return xe(3,12,0,e,t)},ws=function(){ys.log("sending mode data...");const e=t(this,ds,"m",ms).call(this);this.sendRxData(e)};const As=k("XRStateManager"),Ls=["user","airMouse","tapping","dontSend"],xs={user:3,airMouse:1,tapping:2};class Ts{constructor(){Ss.add(this),Cs.set(this,"user"),Is.set(this,new $(t(this,Ss,"m",Rs).bind(this),1e4)),X(this)}get state(){return t(this,Cs,"f")}set state(e){t(this,Ss,"m",Ws).call(this,e),this.state!=e?(s(this,Cs,e,"f"),t(this,Is,"f").isRunning&&t(this,Is,"f").restart(!0)):As.log(`redundant state assignment "${e}"`)}setState(e){this.state=e}start(){t(this,Is,"f").start(!0)}stop(){t(this,Is,"f").stop()}}var $s,Us,Os,Gs,Bs,Fs,Ns,js,Vs,_s,Ps,zs,Js,Ks,Xs,qs,Hs,Qs,Ys,Zs,ei,ti,si,ii,ni,ri,ai,oi,ci,hi,li;Cs=new WeakMap,Is=new WeakMap,Ss=new WeakSet,Ws=function(e){As.assertEnumWithError(e,Ls)},ks=function(){const e=xs[this.state];As.assert(null!=e,`no stateByte found for state "${this.state}"`);return xe(3,13,0,e)},Rs=function(){if("dontSend"==this.state)return;As.log("sending state data...");const e=t(this,Ss,"m",ks).call(this);this.sendRxData(e)};const ui=k("Device",{log:!0}),di=["connectionMessage",...ot,"batteryLevel",...J,...ne,...de,...Ee,...Xe];class fi{get bluetoothId(){return t(this,Fs,"f")?.bluetoothId}get name(){return t(this,Fs,"f")?.name}constructor(){$s.add(this),Gs.set(this,new R(this,di)),Fs.set(this,void 0),this.sendUICommandsData=t(this,$s,"m",Ns).bind(this),this.sendRxData=t(this,$s,"m",js).bind(this),Vs.set(this,!1),Js.set(this,Us.ReconnectOnDisconnection),Ks.set(this,void 0),this.latestConnectionMessage=new Map,ei.set(this,new K),ti.set(this,0),ii.set(this,new Ms),ni.set(this,new Ts),ri.set(this,new ae),ai.set(this,new fe),oi.set(this,new De),ci.set(this,new qe),hi.set(this,new Jt),li.set(this,!1),t(this,ei,"f").eventDispatcher=t(this,Gs,"f"),t(this,ii,"f").sendRxData=this.sendRxData,t(this,ni,"f").sendRxData=this.sendRxData,t(this,ri,"f").eventDispatcher=t(this,Gs,"f"),t(this,ai,"f").eventDispatcher=t(this,Gs,"f"),t(this,oi,"f").eventDispatcher=t(this,Gs,"f"),t(this,ci,"f").eventDispatcher=t(this,Gs,"f"),t(this,hi,"f").sendUICommandsData=this.sendUICommandsData,t(this,ci,"f").rawSensorSensitivity=t(this,ii,"f").sensitivity,this.addEventListener("hardwareRevision",(()=>{})),this.addEventListener("isInAirGestureState",(e=>{t(this,ri,"f").isInAirGestureState=e.message.isInAirGestureState})),this.addEventListener("isConnected",(()=>{this.isConnected?(t(this,ii,"f").start(),setTimeout((()=>{t(this,ii,"f").start()}),100),setTimeout((()=>{t(this,ni,"f").start()}),0)):(t(this,ii,"f").stop(),t(this,ni,"f").stop())})),bs.onDevice(this),n&&window.addEventListener("beforeunload",(()=>{this.isConnected})),r&&process.on("exit",(()=>{this.isConnected}))}get addEventListener(){return t(this,Gs,"f").addEventListener}get removeEventListener(){return t(this,Gs,"f").removeEventListener}get waitForEvent(){return t(this,Gs,"f").waitForEvent}get removeEventListeners(){return t(this,Gs,"f").removeEventListeners}get removeAllEventListeners(){return t(this,Gs,"f").removeAllEventListeners}get connectionManager(){return t(this,Fs,"f")}set connectionManager(e){this.connectionManager!=e?(this.connectionManager&&(this.connectionManager.onStatusUpdated=void 0,this.connectionManager.onMessageReceived=void 0,this.connectionManager.onMessagesReceived=void 0),e&&(e.onStatusUpdated=t(this,$s,"m",Xs).bind(this),e.onMessageReceived=t(this,$s,"m",Ys).bind(this),e.onMessagesReceived=t(this,$s,"m",Zs).bind(this)),s(this,Fs,e,"f"),ui.log("assigned new connectionManager",t(this,Fs,"f"))):ui.log("same connectionManager is already assigned")}async connect(){return this.connectionManager||(this.connectionManager=t(Us,Us,"m",Os).call(Us)),t(this,$s,"m",Qs).call(this),this.connectionManager.connect()}get isConnected(){return t(this,Vs,"f")}get canReconnect(){return this.connectionManager?.canReconnect}async reconnect(){return t(this,$s,"m",Ps).call(this),t(this,$s,"m",Qs).call(this),this.connectionManager?.reconnect()}static async Connect(){const e=new Us;return await e.connect(),e}static get ReconnectOnDisconnection(){return t(this,Us,"f",zs)}static set ReconnectOnDisconnection(e){ui.assertTypeWithError(e,"boolean"),s(this,Us,e,"f",zs)}get reconnectOnDisconnection(){return t(this,Js,"f")}set reconnectOnDisconnection(e){ui.assertTypeWithError(e,"boolean"),s(this,Js,e,"f")}get connectionType(){return this.connectionManager?.type}async disconnect(){return t(this,$s,"m",_s).call(this),this.reconnectOnDisconnection&&(this.reconnectOnDisconnection=!1,this.addEventListener("isConnected",(()=>{this.reconnectOnDisconnection=!0}),{once:!0})),this.connectionManager.disconnect()}toggleConnection(){this.isConnected?this.disconnect():this.canReconnect?this.reconnect():this.connect()}get connectionStatus(){switch(t(this,Fs,"f")?.status){case"connected":return this.isConnected?"connected":"connecting";case"notConnected":case"connecting":case"disconnecting":return t(this,Fs,"f").status;default:return"notConnected"}}get isConnectionBusy(){return"connecting"==this.connectionStatus||"disconnecting"==this.connectionStatus}get deviceInformation(){return t(this,ei,"f").information}get batteryLevel(){return t(this,ti,"f")}get inputMode(){return t(this,ii,"f").mode}get setInputMode(){return t(this,ii,"f").setMode}get setSensitivityForType(){return t(this,ii,"f").setSensitivityForType}get xrState(){return t(this,ni,"f").state}get setXRState(){return t(this,ni,"f").setState}get vibrate(){return t(this,hi,"f").vibrate}get isServerSide(){return t(this,li,"f")}set isServerSide(e){t(this,li,"f")!=e?(ui.log({newIsServerSide:e}),s(this,li,e,"f")):ui.log("redundant isServerSide assignment")}}var gi,vi,mi;Us=fi,Gs=new WeakMap,Fs=new WeakMap,Vs=new WeakMap,Js=new WeakMap,Ks=new WeakMap,ei=new WeakMap,ti=new WeakMap,ii=new WeakMap,ni=new WeakMap,ri=new WeakMap,ai=new WeakMap,oi=new WeakMap,ci=new WeakMap,hi=new WeakMap,li=new WeakMap,$s=new WeakSet,Os=function(){return new _t},Bs=function(){return t(this,Gs,"f").dispatchEvent},Ns=async function(e){await(t(this,Fs,"f")?.sendUICommandsData(e))},js=async function(e){await(t(this,Fs,"f")?.sendRxData(e))},_s=function(){ui.assertWithError(this.isConnected,"notConnected")},Ps=function(){ui.assertWithError(this.canReconnect,"cannot reconnect to device")},Xs=function(e){ui.log({connectionStatus:e}),"notConnected"==e?this.canReconnect&&this.reconnectOnDisconnection&&(ui.log("starting reconnect interval..."),s(this,Ks,setInterval((()=>{ui.log("attempting reconnect..."),this.reconnect()}),1e3),"f")):null!=t(this,Ks,"f")&&(ui.log("clearing reconnect interval"),clearInterval(t(this,Ks,"f")),s(this,Ks,void 0,"f")),t(this,$s,"m",Hs).call(this),"connected"==e&&t(this,Vs,"f"),bs.OnDeviceConnectionStatusUpdated(this,e)},qs=function(e=!1){t(this,$s,"a",Bs).call(this,"connectionStatus",{connectionStatus:this.connectionStatus}),t(this,$s,"a",Bs).call(this,this.connectionStatus,{}),e&&t(this,$s,"a",Bs).call(this,"isConnected",{isConnected:this.isConnected})},Hs=function(){switch(s(this,Vs,Boolean(this.connectionManager?.isConnected),"f"),this.connectionStatus){case"connected":t(this,Vs,"f")&&t(this,$s,"m",qs).call(this,!0);break;case"notConnected":t(this,$s,"m",qs).call(this,!0);break;default:t(this,$s,"m",qs).call(this,!1)}},Qs=function(){this.latestConnectionMessage.clear(),t(this,ei,"f").clear()},Ys=function(e,s){if(ui.log({messageType:e,dataView:s}),"batteryLevel"===e){const e=s.getUint8(0);ui.log("received battery level",{batteryLevel:e}),t(this,$s,"m",si).call(this,e)}else if(z.includes(e))t(this,ei,"f").parseMessage(e,s);else if(ie.includes(e))t(this,ri,"f").parseMessage(e,s);else if(ue.includes(e))t(this,ai,"f").parseMessage(e,s);else if(ye.includes(e))t(this,oi,"f").parseMessage(e,s);else{if(!Ke.includes(e))throw Error(`uncaught messageType "${e}"`);t(this,ci,"f").parseMessage(e,s)}this.latestConnectionMessage.set(e,s),t(this,$s,"a",Bs).call(this,"connectionMessage",{messageType:e,dataView:s})},Zs=function(){this.isConnected||t(this,$s,"m",Hs).call(this)},si=function(e){ui.assertTypeWithError(e,"number"),t(this,ti,"f")!=e?(s(this,ti,e,"f"),ui.log({updatedBatteryLevel:t(this,ti,"f")}),t(this,$s,"a",Bs).call(this,"batteryLevel",{batteryLevel:t(this,ti,"f")})):ui.log(`duplicate batteryLevel assignment ${e}`)},zs={value:!1};const pi={min:1/0,max:-1/0,span:0};vi=new WeakMap,gi=new WeakSet,mi=function(){t(this,vi,"f").span=t(this,vi,"f").max-t(this,vi,"f").min},e.Device=fi,e.DeviceManager=bs,e.Environment=b,e.InputModes=Es,e.MaxNumberOfVibrationSegments=18,e.MaxNumberOfVibrations=9,e.RangeHelper=class{constructor(){gi.add(this),vi.set(this,Object.assign({},pi))}get min(){return t(this,vi,"f").min}get max(){return t(this,vi,"f").max}set min(e){t(this,vi,"f").min=e,t(this,vi,"f").max=Math.max(e,t(this,vi,"f").max),t(this,gi,"m",mi).call(this)}set max(e){t(this,vi,"f").max=e,t(this,vi,"f").min=Math.min(e,t(this,vi,"f").min),t(this,gi,"m",mi).call(this)}reset(){Object.assign(t(this,vi,"f"),pi)}update(e){t(this,vi,"f").min=Math.min(e,t(this,vi,"f").min),t(this,vi,"f").max=Math.max(e,t(this,vi,"f").max),t(this,gi,"m",mi).call(this)}getNormalization(e,s){let i=function(e,t,s,i){return null==i&&(i=s-t),(e-t)/i}(e,t(this,vi,"f").min,t(this,vi,"f").max,t(this,vi,"f").span);return s&&(i*=t(this,vi,"f").span),i||0}updateAndGetNormalization(e,t){return this.update(e),this.getNormalization(e,t)}},e.RawSensorSensitivityFactors=Ce,e.RawSensorTypes=Se,e.XRStates=Ls,e.setAllConsoleLevelFlags=function(e){W.setAllLevelFlags(e)},e.setConsoleLevelFlagsForType=function(e,t){W.setLevelFlagsForType(e,t)}}));
//# sourceMappingURL=tapstrap.min.js.map
